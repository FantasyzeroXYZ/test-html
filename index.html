<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>VAMplayer</title>
    <link rel="icon" href="./assets/VAMplayer_logo.ico" type="image/x-icon">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="./css/style.css">
</head>
<body>
    <header>
        <h1>VAMplayer</h1>
        <p class="subtitle">支持视频/音频播放、字幕显示与Anki制卡</p>
    </header>
    
    <div class="container">
        <!-- Anki配置区域 -->
        <section class="anki-section">
            <div class="anki-container">
                <div class="anki-status-row">
                    <div class="anki-status">
                        <div class="status-indicator" id="anki-status-indicator"></div>
                        <span id="anki-status-text">检查Anki连接状态...</span>
                    </div>
                    <div class="anki-controls">
                        <button class="anki-btn" id="check-anki-btn">状态</button>
                        <button class="anki-btn" id="show-config-btn">配置</button>
                    </div>
                </div>
                
                <!-- 顶部控制按钮 -->
                <div class="top-controls">
                    <button class="media-mode-btn" id="media-mode-btn">
                        <i class="fas fa-video"></i> 视频模式
                    </button>
                    <button class="language-mode-btn" id="language-mode-btn">
                        <i class="fas fa-language"></i> 英语模式
                    </button>
                    <div class="import-controls">
                        <button class="import-btn" id="subtitle-import-btn">
                            <i class="fas fa-closed-captioning"></i> 字幕
                        </button>
                        <button class="import-btn" id="media-import-btn">
                            <i class="fas fa-file-video"></i> 视频
                        </button>
                    </div>
                </div>
                
                <input type="file" id="video-file-input" accept="video/*" class="hidden">
                <input type="file" id="audio-file-input" accept="audio/*" class="hidden">
                <input type="file" id="subtitle-file-input" accept=".srt,.vtt,.txt" class="hidden">
                
                <!-- Anki自动配置区域 -->
                <div class="auto-config-section hidden" id="auto-config-section">
                    <div class="auto-config-row">
                        <label class="auto-config-label" for="deck-select">牌组:</label>
                        <select class="auto-config-select" id="deck-select">
                            <option value="">加载中...</option>
                        </select>
                    </div>
                    <div class="auto-config-row">
                        <label class="auto-config-label" for="model-select">笔记类型:</label>
                        <select class="auto-config-select" id="model-select">
                            <option value="">加载中...</option>
                        </select>
                    </div>
                    <div class="auto-config-row">
                        <label class="auto-config-label" for="word-field-select">单词字段:</label>
                        <select class="auto-config-select" id="word-field-select">
                            <option value="">加载中...</option>
                        </select>
                    </div>
                    <div class="auto-config-row">
                        <label class="auto-config-label" for="sentence-field-select">句子字段:</label>
                        <select class="auto-config-select" id="sentence-field-select">
                            <option value="">加载中...</option>
                        </select>
                    </div>
                    <div class="auto-config-row">
                        <label class="auto-config-label" for="definition-field-select">释义字段:</label>
                        <select class="auto-config-select" id="definition-field-select">
                            <option value="">加载中...</option>
                        </select>
                    </div>
                    <div class="auto-config-row">
                        <label class="auto-config-label" for="audio-field-select">音频字段:</label>
                        <select class="auto-config-select" id="audio-field-select">
                            <option value="">加载中...</option>
                        </select>
                    </div>
                    <div class="auto-config-row">
                        <label class="auto-config-label" for="image-field-select">图片字段:</label>
                        <select class="auto-config-select" id="image-field-select">
                            <option value="">加载中...</option>
                        </select>
                    </div>
                </div>
            </div>
        </section>
        
        <!-- 播放器区域 -->
        <section class="player-section">
            <div class="player-container">
                <div class="audio-info">
                    <div class="album-art">
                        <i id="media-icon">▶</i>
                    </div>
                    <div class="track-info">
                        <h2 id="track-title">请选择媒体文件</h2>
                        <p id="track-description">支持 MP4, AVI, MKV, MP3, WAV 等格式</p>
                    </div>
                </div>
                
                <!-- 视频播放器 -->
                <div class="video-player" id="video-player">
                    <video id="player" controls>
                        您的浏览器不支持HTML5视频播放。
                    </video>
                    <div class="video-subtitles" id="video-subtitles">
                        <!-- 视频内字幕将动态生成 -->
                    </div>
                </div>
                
                <!-- 音频播放器 -->
                <div class="audio-player" id="audio-player">
                    <div class="audio-player-container">
                        <div class="audio-controls">
                            <div class="audio-progress-container">
                                <span class="audio-time" id="audio-current-time">0:00</span>
                                <div class="audio-progress" id="audio-progress">
                                    <div class="audio-progress-filled" id="audio-progress-filled"></div>
                                    <div class="progress-thumb" id="progress-thumb"></div>
                                </div>
                                <span class="audio-time" id="audio-duration">0:00</span>
                            </div>
                            <div class="audio-volume-container">
                                <span>🔊</span>
                                <div class="audio-volume" id="audio-volume">
                                    <div class="audio-volume-filled" id="audio-volume-filled"></div>
                                    <div class="volume-thumb" id="volume-thumb"></div>
                                </div>
                            </div>
                            <div class="audio-buttons">
                                <button class="audio-btn" id="audio-play-pause-btn">▶</button>
                            </div>
                        </div>
                    </div>
                    <div class="audio-subtitles" id="audio-subtitles">
                        <!-- 音频滚动字幕将动态生成 -->
                    </div>
                </div>
                
                <!-- 播放器控制按钮 -->
                <div class="video-controls">
                    <button class="control-btn" id="prev-sentence-btn" title="上一句">
                        <i class="fas fa-step-backward"></i>
                    </button>
                    <button class="control-btn" id="next-sentence-btn" title="下一句">
                        <i class="fas fa-step-forward"></i>
                    </button>
                    <button class="control-btn" id="toggle-video-subtitles-btn" title="切换视频内字幕">
                        <i class="fas fa-closed-captioning"></i>
                    </button>
                    <button class="control-btn" id="show-subtitle-list-btn" title="全部字幕">
                        <i class="fas fa-list"></i>
                    </button>
                    <button class="control-btn" id="toggle-audio-subtitles-btn" title="切换音频字幕">
                        <i class="fas fa-comment-alt"></i>
                    </button>
                    <button class="control-btn" id="clipboard-btn" title="剪贴板功能">
                        <i class="fa fa-clipboard"></i>
                    </button>
                    <button class="control-btn" id="fullscreen-btn" title="全屏播放">
                        <i class="fas fa-expand"></i>
                    </button>
                    <div class="time-input-container">
                        <input type="number" class="time-input" id="time-jump-input" placeholder="时间(秒)" step="0.1" min="0">
                        <button class="time-jump-btn" id="time-jump-btn">跳转</button>
                    </div>
                </div>
            </div>
        </section>
        
        <!-- 字幕显示区域 -->
        <section class="subtitle-section">
            <div class="subtitle-display" id="subtitle-display">
                <div class="subtitle-text" id="subtitle-text">
                    无字幕
                </div>
            </div>
            <div class="subtitle-controls">
                <button class="subtitle-btn" id="toggle-subtitle-btn">显示/隐藏字幕</button>
            </div>
            <p class="hint">提示：直接点击字幕中的单词，该单词会自动查询并显示释义</p>
        </section>
    </div>
    
    <!-- GitHub链接放在黑框外 -->
    <div class="github-link">
        <a href="https://github.com/FantasyzeroXYZ/VAMplayer" target="_blank" title="查看项目源码">
            <i class="fab fa-github"></i>
        </a>
    </div>
    
    <!-- 全屏视频容器 -->
    <div class="fullscreen-video-container" id="fullscreenVideoContainer" style="display: none;">
        <video id="fullscreenVideoPlayer">
            您的浏览器不支持HTML5视频播放。
        </video>
    </div>
    
    <!-- 全屏字幕显示 -->
    <div class="fullscreen-subtitle" id="fullscreenSubtitle" style="display: none;">
        <div class="status-message">全屏模式下，当前播放的字幕将显示在这里</div>
    </div>
    
    <!-- 全屏控制条 -->
    <div class="fullscreen-controls" id="fullscreenControls">
        <button class="fullscreen-control-btn" id="prevSubtitleBtn" title="上一句">⏮</button>
        <button class="fullscreen-control-btn" id="playPauseBtn" title="播放/暂停">⏸</button>
        <button class="fullscreen-control-btn" id="nextSubtitleBtn" title="下一句">⏭</button>
        <div class="fullscreen-progress" id="fullscreenProgress">
            <div class="fullscreen-progress-bar" id="fullscreenProgressBar"></div>
            <!-- 进度条滑块将通过JS动态添加 -->
        </div>
        <div class="fullscreen-time" id="fullscreenTime">00:00 / 00:00</div>
        <button class="fullscreen-control-btn" id="fullscreenDictBtn" title="词典">📖</button>
        <button class="fullscreen-control-btn" id="fullscreenSubtitlesBtn" title="显示全部字幕">📜</button>
    </div>
    
    <!-- 全屏退出按钮 -->
    <button class="exit-fullscreen-btn" id="exitFullscreenBtn" title="退出全屏">✕</button>
    
    <!-- 全屏字幕面板 -->
    <div class="fullscreen-subtitles-panel" id="fullscreenSubtitlesPanel">
        <div class="fullscreen-subtitles-header">
            <h2 class="fullscreen-subtitles-title">全部字幕</h2>
            <button class="close-btn" id="closeSubtitlesBtn">×</button>
        </div>
        
        <div class="fullscreen-subtitles-content" id="fullscreenSubtitlesContent">
            <div class="status-message">请上传SRT字幕文件</div>
        </div>
    </div>
    
    <!-- 全屏字幕面板遮罩 -->
    <div class="fullscreen-subtitles-overlay" id="fullscreenSubtitlesOverlay"></div>
    
    <!-- 底部弹出面板 -->
    <div class="panel-overlay" id="panel-overlay"></div>
    <div class="dictionary-panel" id="dictionary-panel">
        <div class="panel-header">
            <div class="panel-title" id="panel-word-title">词典查询</div>
            <button class="close-panel" id="close-panel">×</button>
        </div>
        
        <!-- 搜索和Anki按钮 -->
        <div class="panel-search-anki-container">
            <div class="panel-search-container">
                <input type="text" class="panel-search-input" id="panel-search-input" placeholder="输入要查询的单词...">
                <button class="panel-search-btn" id="panel-search-btn">
                    <i class="fas fa-search"></i>
                </button>
                <button class="append-word-btn" id="append-word-btn" title="追加词汇">
                    <i class="fas fa-plus"></i>
                </button>
                <button class="panel-anki-btn" id="panel-add-to-anki-btn" title="添加到Anki">
                    <img src="./assets/icons8-anki-24.png" alt="Anki" class="anki-icon">
                </button>
            </div>
        </div>
        
        <div class="original-sentence" id="original-sentence">
            原句将显示在这里...
        </div>
        
        <!-- 标签页导航 -->
        <div class="dictionary-tabs">
            <button class="tab-button active" data-tab="dictionary-tab">词典释义</button>
            <button class="tab-button" data-tab="web-tab">网页查询</button>
            <button class="tab-button" data-tab="tampermonkey-tab" id="tampermonkey-btn">油猴操作</button>
            <button class="tab-button" data-tab="custom-tab">自定义释义</button>
        </div>

        <!-- 标签页内容 -->
        <div class="tab-content">
            <!-- 词典 -->
            <div id="dictionary-tab" class="tab-pane active">
                <div class="dictionary-result" id="panel-dictionary-result">
                    查询结果将显示在这里...
                </div>
            </div>

            <!-- 网页 -->
            <div id="web-tab" class="tab-pane">
                <div class="dictionary-result" id="panel-web-result">
                    <iframe id="web-search-frame" style="width: 100%; height: 300px; border: none;" src="about:blank"></iframe>
                </div>
            </div>

            <!-- 油猴结果 -->
            <div id="tampermonkey-tab" class="tab-pane">
                <div class="dictionary-result" id="panel-tampermonkey-result">
                    <div class="loading">等待油猴返回结果...</div>
                    <div class="experiment-info">
                        还在测试阶段，可以通过脚本添加额外词典，如需使用请先安装油猴脚本：
                        <a href="https://github.com/FantasyzeroXYZ/test-html/releases/download/test/userscripts.zip" target="_blank">点击下载油猴脚本压缩包</a>
                    </div>
                </div>
            </div>

            <!-- 自定义 -->
            <div id="custom-tab" class="tab-pane">
                <div class="custom-definition">
                    <textarea id="panel-custom-definition-input"
                        placeholder="如果查词没有返回内容或者想自定义释义内容，请在此输入..."></textarea>
                </div>
            </div>
        </div>

    </div>
    
    <!-- 字幕列表面板 -->
    <div class="subtitle-list-panel" id="subtitle-list-panel">
        <div class="panel-header" style="margin-top: 0; padding-top: 0;">
            <div class="panel-title">全部字幕</div>
            <button class="close-panel" id="close-subtitle-list-panel">×</button>
        </div>
        
        <ul class="subtitle-list" id="subtitle-list">
            <!-- 字幕列表将动态生成 -->
        </ul>
    </div>
    
    <!-- 词典面板遮罩 -->
    <div class="dictionary-overlay" id="dictionaryOverlay"></div>
    
    <!-- 通知 -->
    <div class="notification" id="notification"></div>

    <footer>
        <p>网页媒体播放器 - 专为语言学习设计</p>
    </footer>

    <!-- 引入kuromoji JS库 -->
    <script src="./kuromoji/build/kuromoji.js"></script>
    <script src="js/dom-elements.js"></script>
    <script src="js/state-variables.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/media-handler.js"></script>
    <script src="js/audio-controls.js"></script>
    <script src="js/subtitle-handler.js"></script>
    <script src="js/dictionary-panel.js"></script>
    <script src="js/anki-handler.js"></script>
    <script src="js/fullscreen-handler.js"></script>
    <script src="js/clipboard-handler.js"></script>
    <script src="js/mobile-optimize.js"></script>
    <script src="js/event-listeners.js"></script>
    <script src="js/init.js"></script>
</body>
</html>