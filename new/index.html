<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IF Studio - 互动小说播放器</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #3498db;
            --secondary-color: #2980b9;
            --accent-color: #e74c3c;
            --light-color: #ecf0f1;
            --dark-color: #2c3e50;
            --success-color: #2ecc71;
            --warning-color: #f39c12;
            --border-radius: 8px;
            --box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s ease;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #1a2a6c, #2c3e50);
            color: var(--light-color);
            line-height: 1.6;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: var(--border-radius);
            backdrop-filter: blur(10px);
            box-shadow: var(--box-shadow);
        }
        
        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            color: var(--light-color);
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }
        
        .subtitle {
            font-size: 1.2rem;
            color: #bdc3c7;
        }
        
        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }
        
        @media (max-width: 900px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }
        
        .card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: var(--border-radius);
            padding: 25px;
            box-shadow: var(--box-shadow);
            backdrop-filter: blur(10px);
            transition: var(--transition);
        }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
        }
        
        .card-title {
            font-size: 1.5rem;
            margin-bottom: 20px;
            color: var(--light-color);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .card-title i {
            color: var(--primary-color);
        }
        
        /* 游戏区域样式 */
        .game-container {
            display: flex;
            flex-direction: column;
            height: 600px;
        }
        
        .game-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .game-title {
            font-size: 1.8rem;
            color: var(--light-color);
        }
        
        .game-controls {
            display: flex;
            gap: 10px;
        }
        
        .btn {
            padding: 8px 15px;
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .btn:hover {
            background: var(--secondary-color);
        }
        
        .btn-accent {
            background: var(--accent-color);
        }
        
        .btn-accent:hover {
            background: #c0392b;
        }
        
        .game-output {
            flex: 1;
            background: rgba(0, 0, 0, 0.3);
            border-radius: var(--border-radius);
            padding: 20px;
            overflow-y: auto;
            margin-bottom: 15px;
            font-family: 'Courier New', monospace;
            line-height: 1.8;
        }
        
        .game-input-container {
            display: flex;
            gap: 10px;
        }
        
        .game-input {
            flex: 1;
            padding: 12px 15px;
            border: none;
            border-radius: var(--border-radius);
            background: rgba(255, 255, 255, 0.9);
            color: var(--dark-color);
            font-size: 1rem;
        }
        
        .game-input:focus {
            outline: 2px solid var(--primary-color);
        }
        
        /* 学习面板样式 */
        .learning-panel {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .word-info-card {
            min-height: 200px;
        }
        
        .word-info {
            margin-top: 15px;
            padding: 15px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: var(--border-radius);
            display: none;
        }
        
        .word-info.active {
            display: block;
        }
        
        .word-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .word-text {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--primary-color);
        }
        
        .phonetic {
            color: #bdc3c7;
            font-style: italic;
            margin-bottom: 10px;
        }
        
        .definition {
            margin-bottom: 10px;
            line-height: 1.6;
        }
        
        .example {
            font-style: italic;
            color: #ecf0f1;
            border-left: 3px solid var(--secondary-color);
            padding-left: 10px;
            margin: 10px 0;
        }
        
        .add-to-vocab {
            background: var(--success-color);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: var(--border-radius);
            cursor: pointer;
            margin-top: 10px;
            transition: var(--transition);
        }
        
        .add-to-vocab:hover {
            background: #27ae60;
        }
        
        .vocabulary-card {
            max-height: 300px;
            display: flex;
            flex-direction: column;
        }
        
        .vocabulary-list {
            flex: 1;
            overflow-y: auto;
            margin-top: 10px;
        }
        
        .vocab-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .vocab-word {
            font-weight: bold;
            color: var(--primary-color);
        }
        
        .vocab-actions {
            display: flex;
            gap: 10px;
        }
        
        .vocab-action-btn {
            background: none;
            border: none;
            cursor: pointer;
            color: var(--light-color);
            font-size: 0.9rem;
            transition: var(--transition);
        }
        
        .vocab-action-btn:hover {
            color: var(--primary-color);
        }
        
        .tts-controls {
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .tts-btn {
            padding: 8px 15px;
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: var(--border-radius);
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 5px;
            transition: var(--transition);
        }
        
        .tts-btn:hover {
            background: var(--secondary-color);
        }
        
        .tts-btn.recording {
            background: var(--accent-color);
        }
        
        /* 游戏库样式 */
        .games-library {
            margin-top: 30px;
        }
        
        .games-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .game-card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: var(--border-radius);
            padding: 20px;
            box-shadow: var(--box-shadow);
            transition: var(--transition);
            cursor: pointer;
            text-align: center;
        }
        
        .game-card:hover {
            transform: translateY(-5px);
            background: rgba(255, 255, 255, 0.15);
        }
        
        .game-icon {
            font-size: 2.5rem;
            margin-bottom: 15px;
            color: var(--primary-color);
        }
        
        .game-card-title {
            font-size: 1.2rem;
            margin-bottom: 10px;
        }
        
        .game-card-desc {
            font-size: 0.9rem;
            color: #bdc3c7;
        }
        
        .highlight {
            background: rgba(255, 126, 95, 0.3);
            cursor: pointer;
            padding: 0 2px;
            border-radius: 3px;
            transition: var(--transition);
        }
        
        .highlight:hover {
            background: rgba(255, 126, 95, 0.5);
        }
        
        .status-bar {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
            font-size: 0.9rem;
            color: #bdc3c7;
        }
        
        footer {
            text-align: center;
            margin-top: 40px;
            padding: 20px;
            color: #bdc3c7;
            font-size: 0.9rem;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>IF Studio - 互动小说播放器</h1>
            <p class="subtitle">支持多种互动小说格式，专为语言学习设计</p>
        </header>
        
        <div class="main-content">
            <!-- 游戏区域 -->
            <div class="card game-container">
                <div class="game-header">
                    <h2 class="game-title">Zork: The Great Underground Empire</h2>
                    <div class="game-controls">
                        <button class="btn" id="loadGameBtn">
                            <i class="fas fa-folder-open"></i> 加载游戏
                        </button>
                        <button class="btn" id="saveGameBtn">
                            <i class="fas fa-save"></i> 保存进度
                        </button>
                        <button class="btn btn-accent" id="restartGameBtn">
                            <i class="fas fa-redo"></i> 重新开始
                        </button>
                    </div>
                </div>
                
                <div class="game-output" id="gameOutput">
                    <p>欢迎来到互动小说播放器！</p>
                    <p>这是一个支持多种互动小说格式的播放器，包括 Z-machine (.z3, .z5, .z8), Glulx (.ulx), TADS (.t3) 等。</p>
                    <p>请点击"加载游戏"按钮选择您的游戏文件，或从下方的游戏库中选择一个示例游戏。</p>
                    <p>要开始游戏，请在下方输入命令，如 "look", "go north", "take lamp" 等。</p>
                    <br>
                    <p>语言学习功能：</p>
                    <ul>
                        <li>点击高亮单词查看释义</li>
                        <li>使用生词本记录不熟悉的单词</li>
                        <li>文本朗读功能帮助发音练习</li>
                    </ul>
                </div>
                
                <div class="game-input-container">
                    <input type="text" class="game-input" id="gameInput" placeholder="输入命令 (例如: look, go north, take item)">
                    <button class="btn" id="sendCommandBtn">
                        <i class="fas fa-paper-plane"></i> 发送
                    </button>
                </div>
                
                <div class="status-bar">
                    <div>状态: <span id="gameStatus">就绪</span></div>
                    <div>字数: <span id="wordCount">0</span></div>
                </div>
            </div>
            
            <!-- 学习面板 -->
            <div class="learning-panel">
                <div class="card word-info-card">
                    <h3 class="card-title">
                        <i class="fas fa-book"></i> 单词查询
                    </h3>
                    <p>点击游戏文本中的高亮单词查看释义</p>
                    
                    <div class="word-info" id="wordInfo">
                        <div class="word-header">
                            <span class="word-text" id="wordText">example</span>
                            <button class="add-to-vocab" id="addToVocabBtn">加入生词本</button>
                        </div>
                        <div class="phonetic" id="wordPhonetic">/ɪɡˈzæmpəl/</div>
                        <div class="definition" id="wordDefinition">n. 例子；范例；榜样</div>
                        <div class="example" id="wordExample">This is a good example of how to solve the problem.</div>
                        <div class="translation" id="wordTranslation">这是解决问题的一个好例子。</div>
                    </div>
                </div>
                
                <div class="card vocabulary-card">
                    <h3 class="card-title">
                        <i class="fas fa-bookmark"></i> 我的生词本
                        <button class="vocab-action-btn" id="clearVocabBtn">清空</button>
                    </h3>
                    <div class="vocabulary-list" id="vocabularyList">
                        <!-- 生词列表将通过JavaScript动态生成 -->
                        <div style="text-align: center; padding: 20px; color: #bdc3c7;">
                            生词本为空
                        </div>
                    </div>
                </div>
                
                <div class="card">
                    <h3 class="card-title">
                        <i class="fas fa-volume-up"></i> 朗读控制
                    </h3>
                    <div class="tts-controls">
                        <button class="tts-btn" id="readAloudBtn">
                            <i class="fas fa-play"></i> 朗读文本
                        </button>
                        <button class="tts-btn" id="repeatSentenceBtn">
                            <i class="fas fa-microphone"></i> 跟读练习
                        </button>
                        <button class="tts-btn" id="slowReadBtn">
                            <i class="fas fa-tachometer-alt"></i> 慢速朗读
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- 游戏库 -->
        <div class="card games-library">
            <h3 class="card-title">
                <i class="fas fa-gamepad"></i> 游戏库
            </h3>
            <p>选择以下示例游戏开始，或使用上方的"加载游戏"按钮加载您自己的游戏文件</p>
            
            <div class="games-grid">
                <div class="game-card" data-game="zork">
                    <div class="game-icon">
                        <i class="fas fa-dungeon"></i>
                    </div>
                    <h4 class="game-card-title">Zork I</h4>
                    <p class="game-card-desc">经典地下城冒险游戏</p>
                </div>
                
                <div class="game-card" data-game="curses">
                    <div class="game-icon">
                        <i class="fas fa-ghost"></i>
                    </div>
                    <h4 class="game-card-title">Curses</h4>
                    <p class="game-card-desc">复杂的解谜冒险</p>
                </div>
                
                <div class="game-card" data-game="anchorhead">
                    <div class="game-icon">
                        <i class="fas fa-anchor"></i>
                    </div>
                    <h4 class="game-card-title">Anchorhead</h4>
                    <p class="game-card-desc">Lovecraft式恐怖故事</p>
                </div>
                
                <div class="game-card" data-game="photopia">
                    <div class="game-icon">
                        <i class="fas fa-palette"></i>
                    </div>
                    <h4 class="game-card-title">Photopia</h4>
                    <p class="game-card-desc">情感丰富的故事体验</p>
                </div>
            </div>
        </div>
        
        <footer>
            <p>IF Studio - 互动小说播放器 &copy; 2023 | 专为语言学习者设计</p>
            <p>支持格式: Z-machine (.z3, .z5, .z8), Glulx (.ulx), TADS (.t3), 以及 HTML 互动小说</p>
        </footer>
    </div>

    <script>
        // 示例单词词典
        const wordDictionary = {
            "welcome": {
                phonetic: "/ˈwelkəm/",
                definition: "v. 欢迎；迎接 n. 欢迎 adj. 受欢迎的",
                example: "We welcome you to our city.",
                translation: "欢迎您来到我们的城市。"
            },
            "interactive": {
                phonetic: "/ˌɪntərˈæktɪv/",
                definition: "adj. 交互式的；互动的",
                example: "The museum has many interactive exhibits.",
                translation: "博物馆有许多互动式展览。"
            },
            "fiction": {
                phonetic: "/ˈfɪkʃn/",
                definition: "n. 小说；虚构；编造",
                example: "She enjoys reading science fiction.",
                translation: "她喜欢阅读科幻小说。"
            },
            "command": {
                phonetic: "/kəˈmænd/",
                definition: "n. 命令；指挥 v. 命令；指挥",
                example: "He gave the command to attack.",
                translation: "他发出了攻击的命令。"
            },
            "adventure": {
                phonetic: "/ədˈventʃər/",
                definition: "n. 冒险；奇遇 v. 冒险",
                example: "They went on an adventure in the jungle.",
                translation: "他们在丛林中冒险。"
            },
            "puzzle": {
                phonetic: "/ˈpʌzl/",
                definition: "n. 谜；难题 v. 使困惑",
                example: "This crossword puzzle is very difficult.",
                translation: "这个填字游戏非常难。"
            },
            "inventory": {
                phonetic: "/ˈɪnvəntri/",
                definition: "n. 库存；清单；存货",
                example: "Please check the inventory before ordering.",
                translation: "订购前请检查库存。"
            },
            "location": {
                phonetic: "/loʊˈkeɪʃn/",
                definition: "n. 位置；地点；定位",
                example: "The hotel is in a convenient location.",
                translation: "酒店位于一个便利的位置。"
            },
            "mysterious": {
                phonetic: "/mɪˈstɪəriəs/",
                definition: "adj. 神秘的；难以理解的",
                example: "He disappeared under mysterious circumstances.",
                translation: "他在神秘的情况下消失了。"
            },
            "treasure": {
                phonetic: "/ˈtreʒər/",
                definition: "n. 财富；珍宝 v. 珍爱",
                example: "They went searching for buried treasure.",
                translation: "他们去寻找埋藏的宝藏。"
            }
        };

        // 应用状态
        let currentGame = null;
        let gameHistory = [];
        let vocabulary = JSON.parse(localStorage.getItem('ifVocabulary')) || [];
        let speechSynthesis = window.speechSynthesis;

        // DOM元素
        const gameOutput = document.getElementById('gameOutput');
        const gameInput = document.getElementById('gameInput');
        const sendCommandBtn = document.getElementById('sendCommandBtn');
        const loadGameBtn = document.getElementById('loadGameBtn');
        const saveGameBtn = document.getElementById('saveGameBtn');
        const restartGameBtn = document.getElementById('restartGameBtn');
        const wordInfo = document.getElementById('wordInfo');
        const wordText = document.getElementById('wordText');
        const wordPhonetic = document.getElementById('wordPhonetic');
        const wordDefinition = document.getElementById('wordDefinition');
        const wordExample = document.getElementById('wordExample');
        const wordTranslation = document.getElementById('wordTranslation');
        const addToVocabBtn = document.getElementById('addToVocabBtn');
        const vocabularyList = document.getElementById('vocabularyList');
        const clearVocabBtn = document.getElementById('clearVocabBtn');
        const readAloudBtn = document.getElementById('readAloudBtn');
        const repeatSentenceBtn = document.getElementById('repeatSentenceBtn');
        const slowReadBtn = document.getElementById('slowReadBtn');
        const gameStatus = document.getElementById('gameStatus');
        const wordCount = document.getElementById('wordCount');
        const gameCards = document.querySelectorAll('.game-card');

        // 初始化应用
        function init() {
            setupEventListeners();
            updateVocabularyList();
            highlightWordsInOutput();
            updateWordCount();
        }

        // 设置事件监听器
        function setupEventListeners() {
            // 发送命令
            sendCommandBtn.addEventListener('click', sendCommand);
            gameInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') sendCommand();
            });
            
            // 游戏控制
            loadGameBtn.addEventListener('click', loadGameFile);
            saveGameBtn.addEventListener('click', saveGame);
            restartGameBtn.addEventListener('click', restartGame);
            
            // 单词查询
            addToVocabBtn.addEventListener('click', addToVocabulary);
            clearVocabBtn.addEventListener('click', clearVocabulary);
            
            // 朗读控制
            readAloudBtn.addEventListener('click', readAloud);
            repeatSentenceBtn.addEventListener('click', repeatSentence);
            slowReadBtn.addEventListener('click', slowRead);
            
            // 游戏库
            gameCards.forEach(card => {
                card.addEventListener('click', () => {
                    const game = card.dataset.game;
                    loadExampleGame(game);
                });
            });
            
            // 点击单词事件委托
            gameOutput.addEventListener('click', (e) => {
                if (e.target.classList.contains('highlight')) {
                    const word = e.target.dataset.word;
                    showWordInfo(word);
                }
            });
        }

        // 发送命令
        function sendCommand() {
            const command = gameInput.value.trim();
            if (!command) return;
            
            // 添加到输出
            addToOutput(`<div class="user-command">>&gt; ${command}</div>`);
            
            // 处理命令
            processCommand(command);
            
            // 清空输入
            gameInput.value = '';
            
            // 高亮新输出的单词
            highlightWordsInOutput();
            updateWordCount();
        }

        // 处理命令（简化版）
        function processCommand(command) {
            // 在实际实现中，这里会调用互动小说解释器
            // 这里使用模拟响应
            
            const cmd = command.toLowerCase();
            let response = '';
            
            if (cmd === 'look') {
                response = `你位于一个普通的小房间。房间里有一张桌子，上面放着一盏旧油灯。北面有一扇门。`;
            } else if (cmd === 'go north' || cmd === 'n') {
                response = `你进入了另一个房间。这个房间比之前的要大，墙上挂着一幅神秘的画。房间的东侧有一个书架。`;
            } else if (cmd === 'take lamp' || cmd === 'get lamp') {
                response = `你拿起了油灯。它看起来很古老，但保存得相当完好。`;
            } else if (cmd === 'inventory' || cmd === 'i') {
                response = `你携带：<br>- 一盏油灯`;
            } else if (cmd === 'examine painting' || cmd === 'look at painting') {
                response = `这幅画描绘了一个神秘的风景，画中有一个隐藏的符号。符号看起来像是一个古老的谜题。`;
            } else if (cmd === 'read book') {
                response = `书架上有很多书，但大部分都是普通的参考书。有一本红色封面的书看起来特别有趣。`;
            } else {
                response = `我不理解"${command}"。尝试使用简单的命令如 look, go north, take item, inventory 等。`;
            }
            
            // 添加游戏响应
            addToOutput(response);
            
            // 保存到历史
            gameHistory.push({command, response});
        }

        // 添加到输出
        function addToOutput(html) {
            gameOutput.innerHTML += html;
            gameOutput.scrollTop = gameOutput.scrollHeight;
        }

        // 高亮输出中的单词
        function highlightWordsInOutput() {
            const words = Object.keys(wordDictionary);
            let content = gameOutput.innerHTML;
            
            // 为每个单词添加高亮标记
            words.forEach(word => {
                const regex = new RegExp(`\\b${word}\\b`, 'gi');
                content = content.replace(regex, 
                    `<span class="highlight" data-word="${word.toLowerCase()}">$&</span>`
                );
            });
            
            gameOutput.innerHTML = content;
        }

        // 更新字数统计
        function updateWordCount() {
            const text = gameOutput.textContent || gameOutput.innerText;
            const count = text.split(/\s+/).filter(word => word.length > 0).length;
            wordCount.textContent = count;
        }

        // 显示单词信息
        function showWordInfo(word) {
            const wordData = wordDictionary[word.toLowerCase()];
            if (!wordData) return;
            
            wordText.textContent = word;
            wordPhonetic.textContent = wordData.phonetic;
            wordDefinition.textContent = wordData.definition;
            wordExample.textContent = wordData.example;
            wordTranslation.textContent = wordData.translation;
            
            wordInfo.classList.add('active');
            
            // 更新添加到生词本按钮状态
            const isInVocabulary = vocabulary.includes(word.toLowerCase());
            addToVocabBtn.textContent = isInVocabulary ? '已在生词本' : '加入生词本';
            addToVocabBtn.disabled = isInVocabulary;
        }

        // 添加到生词本
        function addToVocabulary() {
            const word = wordText.textContent;
            if (!vocabulary.includes(word.toLowerCase())) {
                vocabulary.push(word.toLowerCase());
                localStorage.setItem('ifVocabulary', JSON.stringify(vocabulary));
                updateVocabularyList();
                
                // 更新按钮状态
                addToVocabBtn.textContent = '已在生词本';
                addToVocabBtn.disabled = true;
            }
        }

        // 更新生词本列表
        function updateVocabularyList() {
            vocabularyList.innerHTML = '';
            
            if (vocabulary.length === 0) {
                vocabularyList.innerHTML = '<div style="text-align: center; padding: 20px; color: #bdc3c7;">生词本为空</div>';
                return;
            }
            
            vocabulary.forEach((word, index) => {
                const item = document.createElement('div');
                item.className = 'vocab-item';
                
                const wordInfo = document.createElement('div');
                wordInfo.className = 'vocab-word';
                wordInfo.textContent = word;
                
                const actions = document.createElement('div');
                actions.className = 'vocab-actions';
                
                const lookupBtn = document.createElement('button');
                lookupBtn.className = 'vocab-action-btn';
                lookupBtn.innerHTML = '<i class="fas fa-search"></i> 查看';
                lookupBtn.addEventListener('click', () => {
                    showWordInfo(word);
                });
                
                const removeBtn = document.createElement('button');
                removeBtn.className = 'vocab-action-btn';
                removeBtn.innerHTML = '<i class="fas fa-trash"></i> 移除';
                removeBtn.addEventListener('click', () => {
                    removeFromVocabulary(word, index);
                });
                
                actions.appendChild(lookupBtn);
                actions.appendChild(removeBtn);
                
                item.appendChild(wordInfo);
                item.appendChild(actions);
                
                vocabularyList.appendChild(item);
            });
        }

        // 从生词本移除
        function removeFromVocabulary(word, index) {
            vocabulary.splice(index, 1);
            localStorage.setItem('ifVocabulary', JSON.stringify(vocabulary));
            updateVocabularyList();
            
            // 如果当前显示的是被移除的单词，更新按钮状态
            if (wordText.textContent.toLowerCase() === word.toLowerCase()) {
                addToVocabBtn.textContent = '加入生词本';
                addToVocabBtn.disabled = false;
            }
        }

        // 清空生词本
        function clearVocabulary() {
            if (confirm('确定要清空生词本吗？')) {
                vocabulary = [];
                localStorage.setItem('ifVocabulary', JSON.stringify(vocabulary));
                updateVocabularyList();
                
                // 重置当前显示的单词信息
                addToVocabBtn.textContent = '加入生词本';
                addToVocabBtn.disabled = false;
            }
        }

        // 朗读文本
        function readText(text, rate = 1) {
            if (speechSynthesis.speaking) {
                speechSynthesis.cancel();
            }
            
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = 'en-US';
            utterance.rate = rate;
            
            speechSynthesis.speak(utterance);
        }

        // 朗读当前输出
        function readAloud() {
            const text = gameOutput.textContent || gameOutput.innerText;
            readText(text);
        }

        // 跟读练习
        function repeatSentence() {
            const text = gameOutput.textContent || gameOutput.innerText;
            // 获取最后一段文本
            const paragraphs = text.split('\n').filter(p => p.trim().length > 0);
            const lastParagraph = paragraphs[paragraphs.length - 1] || text;
            readText(lastParagraph, 0.7);
        }

        // 慢速朗读
        function slowRead() {
            const text = gameOutput.textContent || gameOutput.innerText;
            readText(text, 0.5);
        }

        // 加载游戏文件
        function loadGameFile() {
            // 在实际实现中，这里会使用FileReader读取游戏文件
            // 然后传递给适当的解释器 (Parchment, Quixe, etc.)
            alert('在实际实现中，这里会打开文件选择器来加载游戏文件。目前使用示例游戏。');
            loadExampleGame('zork');
        }

        // 加载示例游戏
        function loadExampleGame(game) {
            gameStatus.textContent = '加载中...';
            
            // 模拟加载延迟
            setTimeout(() => {
                currentGame = game;
                gameOutput.innerHTML = '';
                
                let introText = '';
                switch(game) {
                    case 'zork':
                        introText = `<p>Zork I: The Great Underground Empire</p>
                                    <p>版权所有 (c) 1981, 1982, 1983 Infocom, Inc. 保留所有权利。</p>
                                    <p>Zork 是 Infocom, Inc. 的注册商标。</p>
                                    <br>
                                    <p>西边是一所白色的小房子。</p>
                                    <p>你正站在一片开阔的田野中，西边是一所白色的小房子。田野里有一口 mailbox（邮箱）。</p>`;
                        break;
                    case 'curses':
                        introText = `<p>Curses</p>
                                    <p>版权所有 (c) 1993 Graham Nelson</p>
                                    <br>
                                    <p>大厅</p>
                                    <p>你站在一个宽敞的大厅里，装饰着维多利亚时代的华丽风格。大厅的北端有一个巨大的楼梯，通向楼上。东边和西边各有一扇门。</p>`;
                        break;
                    case 'anchorhead':
                        introText = `<p>Anchorhead</p>
                                    <p>版权所有 (c) 1998 Michael Gentry</p>
                                    <br>
                                    <p>你和你丈夫 Michael 刚刚搬进了这座古老的海边小镇 Anchorhead 的祖传宅邸。雨已经连续下了好几天了。</p>
                                    <p>你现在站在宅邸的门厅里。这里又暗又冷，空气中弥漫着一股霉味。</p>`;
                        break;
                    case 'photopia':
                        introText = `<p>Photopia</p>
                                    <p>版权所有 (c) 1998 Adam Cadre</p>
                                    <br>
                                    <p>你坐在朋友的汽车后座上。车里充满了香烟的烟雾，让你感到有些头晕。</p>
                                    <p>你的朋友正在开车，他看起来有点紧张。</p>`;
                        break;
                }
                
                addToOutput(introText);
                gameStatus.textContent = '游戏中';
                highlightWordsInOutput();
                updateWordCount();
            }, 1000);
        }

        // 保存游戏
        function saveGame() {
            if (!currentGame) {
                alert('没有正在进行的游戏。');
                return;
            }
            
            // 在实际实现中，这里会保存游戏状态
            alert('游戏进度已保存！');
            gameStatus.textContent = '已保存';
        }

        // 重新开始游戏
        function restartGame() {
            if (!currentGame) {
                alert('没有正在进行的游戏。');
                return;
            }
            
            if (confirm('确定要重新开始游戏吗？当前进度将丢失。')) {
                loadExampleGame(currentGame);
            }
        }

        // 初始化应用
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>